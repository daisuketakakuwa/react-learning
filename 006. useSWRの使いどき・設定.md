# 使い時
## useSWR使うパターン
- 取得して FE で情報を使う系
  - 一覧取得
  - 詳細取得

## useSWR使わないパターン
- レスポンスをFEで使わない系
  - ログアウト
  - 登録系（createした後、`mutate('/api/xxx'）`でrevalidate）
  - 更新系（updateした後、`mutate('/api/xxx'）`でrevalidate）
  - 削除系（deleteした後、`mutate('/api/xxx'）`でrevalidate）
- レスポンスをFEで使うけど...useSWRは使わない方がいい(**キャッシュしない方がいい***)パターン
  - ログイン

ログインAPIの主目的は "副作用(認証状態/Cookieを変更する)"である。<br>
・ついでに user情報 を返しているだけ なので、このuser情報をSWRでキャッシュしない方がいい。

# SWRの設定（大事なやつだけ）

|ジャンル|項目|内容|
|----|----|----|
|再検証<br>のタイミング|`revalidateOnMount`|マウント時に必ず再取得するか。デフォ`True`。|
|再検証<br>のタイミング|`revalidateOnFocus`|タブに戻った時に自動GET。デフォ`True`。|
|再検証<br>のタイミング|`revalidateOnReconnect`|オフライン → オンライン復帰時に再取得。デフォ`True`。|
|重複コール制御|`dedupingInterval`|同じ key の GET を この時間内は1回にまとめる。デフォ`2秒`|
|ローディング|`loadingTimeout`|この時間を超えたら`onLoadingSlow`が呼ばれる。UX 改善（遅延警告）用。デフォ`3秒`|
|リトライ制御|`shouldRetryOnError`|`fetcher`が失敗したら再試行するか。デフォ`True`。|
|ポーリング|`refreshInterval`|定期的に再取得（ポーリング）。デフォ値「`0(無効)`」|

コールバック系の設定とか色々他にもある。

上記デフォ値に対して実務で設定した方がいいやつ。
```tsx
        <SWRConfig
            value={{
                revalidateOnFocus: false,
                revalidateOnReconnect: false,
                shouldRetryOnError: false,
            }}
        >
```

## OnFocus ってどう検知するの？
👉ブラウザの `visibilitychange` と `focus` 系イベントで検知される。<br>

ここでいうFocusは<br>
〇 タブ or ウィンドウがユーザーの操作対象になった瞬間<br>
✕ タブ内のinput要素がfocusされたとき

## オフライン → オンライン復帰 ってどう検知するの？
👉ブラウザが「オンライン状態(`navigator.onLine`)」を管理している。<br>
　→ これをSWR内部でも参照しているという話。
```tsx
// ネットワークがOff⇒Onになった時に実行
window.addEventListener('online', () => {});
// ネットワークがOn⇒Offになった時に実行
window.addEventListener('offline', () => {});
```







